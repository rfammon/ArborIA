<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>ArborIA - Sistema de Manejo Integrado Arb√≥reo</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#00796b">
    <link rel="apple-touch-icon" href="img/icons/icon-192x192.png">
    <link rel="icon" type="image/png" href="img/icons/favicon.png">
    
    <link rel="stylesheet" href="style.css?v=77.0"> 
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>

    <header class="header-main" id="page-top"> 
        <div class="logo-container">
            <span class="arboria-text"><span class="blue">Arbor</span><span class="green">IA</span></span>
            <img src="img/icons/favicon.png" alt="Logo ArborIA" class="header-logo">
        </div>
        <p class="app-description">Sistema de Manejo Integrado Arb√≥reo</p>
    </header>

    <main>
        
        <div id="app-content">
            <section class="mapa-navegacao">
                <h2>Painel de Controle</h2>
                <nav class="topicos-container">
                    <button class="topico-btn active" data-target="conceitos-basicos">üí° Defini√ß√µes e Termos</button>
                    <button class="topico-btn" data-target="planejamento-inspecao">üìã Planejamento e Risco</button>
                    <button class="topico-btn" data-target="autorizacao-legal">üìú Termos Legais (ASV)</button>
                    <button class="topico-btn" data-target="preparacao-e-isolamento">üöß Prepara√ß√£o (Isolamento)</button>
                    <button class="topico-btn" data-target="operacoes-e-tecnicas">‚úÇÔ∏è Poda e Supress√£o</button>
                    <button class="topico-btn" data-target="riscos-e-epis">üõ°Ô∏è EPIs e An√°lise de Risco</button>
                    <button class="topico-btn" data-target="gestao-e-desmobilizacao">‚ôªÔ∏è Res√≠duos (MTR)</button>
                    <button class="topico-btn" data-target="glossario-geral">üìò Gloss√°rio Geral</button>
                    <button class="topico-btn" data-target="sobre-autor">üë®‚Äçüíª Sobre o Autor</button>
                    
                    <button class="topico-btn" data-target="calculadora-risco">üìä Calculadora de Risco</button>
                    <button class="topico-btn" data-target="clinometro-view">üìê Clin√¥metro (Altura)</button>
                    <button class="topico-btn" data-target="dap-estimator-view">üìè Medir DAP</button> 
                </nav>
            </section>

            <section class="conteudo-detalhe" id="manual-view">
                <div id="detalhe-view"></div>
            </section>

            <section class="app-view conteudo-detalhe" id="clinometro-view" style="display: none; padding: 0; overflow: hidden; background: #000;">
                <div id="camera-container">
                    <video id="camera-feed" autoplay playsinline muted></video>
                    <div class="crosshair"></div>
                    
                    <div class="hud-overlay">
                        <div class="hud-top">
                            <span id="clinometer-angle">0.0¬∞</span>
                            <button type="button" id="close-clinometer" class="hud-close-btn">‚úñ Sair</button>
                        </div>
                        
                        <div class="hud-controls">
                            <div id="step-distance" class="hud-step active">
                                <label>Dist√¢ncia da √Årvore (m):</label>
                                <input type="number" id="clino-distance" value="10" min="1" step="0.5">
                                <button id="btn-start-measure" class="hud-action-btn">Iniciar Medi√ß√£o</button>
                            </div>
                            <div id="step-base" class="hud-step">
                                <p>Mire na <strong>BASE</strong> da √°rvore</p>
                                <button id="btn-capture-base" class="hud-capture-btn">Capturar Base</button>
                            </div>
                            <div id="step-top" class="hud-step">
                                <p>Mire no <strong>TOPO</strong> da √°rvore</p>
                                <button id="btn-capture-top" class="hud-capture-btn">Capturar Topo</button>
                            </div>
                            <div id="step-result" class="hud-step">
                                <p>Altura Estimada:</p>
                                <h1 id="tree-height-result">0.0 m</h1>
                                <div class="result-actions">
                                    <button id="btn-reset-measure" class="hud-action-btn">Nova Medi√ß√£o</button>
                                    <button id="btn-save-height" class="hud-action-btn save">‚úÖ Usar no Cadastro</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section class="app-view conteudo-detalhe" id="dap-estimator-view" style="display: none; padding: 0; overflow: hidden; background: #000;">
                <div id="dap-camera-container">
                    <video id="dap-camera-feed" autoplay playsinline muted></video>
                    <div class="crosshair"></div>
                    
                    <div class="hud-overlay">
                        <div class="hud-top">
                            <span id="dap-current-angle">0.0¬∞</span> 
                            <button type="button" id="close-dap-estimator" class="hud-close-btn">‚úñ Sair</button>
                        </div>
                        
                        <div class="hud-controls">
                            <div id="dap-step-distance" class="hud-step active">
                                <p><strong>1. Configura√ß√£o</strong></p>
                                <label>Dist√¢ncia at√© o tronco (m):</label>
                                <input type="number" id="dap-distance-input" value="10" min="1" step="0.5">
                                <p class="instruction-text">Mantenha esta dist√¢ncia fixa. Aponte a c√¢mera para a altura do peito (1.30m).</p>
                                <button id="btn-dap-next-step" class="hud-action-btn">Come√ßar</button>
                            </div>
                            <div id="dap-step-left" class="hud-step">
                                <p><strong>2. Borda Esquerda</strong></p>
                                <p class="instruction-text">Alinhe a mira na borda <strong>ESQUERDA</strong> do tronco.</p>
                                <button id="btn-dap-capture-left" class="hud-capture-btn">Capturar</button>
                            </div>
                            <div id="dap-step-right" class="hud-step">
                                <p><strong>3. Borda Direita</strong></p>
                                <p class="instruction-text">Gire o celular e alinhe na borda <strong>DIREITA</strong>.</p>
                                <button id="btn-dap-capture-right" class="hud-capture-btn">Capturar</button>
                            </div>
                            <div id="dap-step-result" class="hud-step">
                                <p>DAP Estimado:</p>
                                <h1 id="dap-estimated-result">0.0 cm</h1>
                                <div class="result-actions">
                                    <button id="btn-dap-reset" class="hud-action-btn">Nova Medi√ß√£o</button>
                                    <button id="btn-dap-save" class="hud-action-btn save">‚úÖ Usar no Cadastro</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section class="app-view conteudo-detalhe" id="calculadora-view" style="display: none;">
                
                <h3>üìä Calculadora de Risco Arb√≥reo</h3>
                <p>Use o mapa para visualiza√ß√£o geoespacial do risco, a aba "Registrar" para coleta e "Resumo" para gerenciar os dados.</p>
                
                <nav class="sub-nav">
                    <button type="button" class="sub-nav-btn" data-target="tab-content-register">Registrar √Årvore</button>
                    <button type="button" class="sub-nav-btn" data-target="tab-content-summary">Resumo da Vistoria <span id="summary-badge" class="badge"></span></button>
                    <button type="button" class="sub-nav-btn" data-target="tab-content-mapa">Mapa GIS üó∫Ô∏è</button>
                </nav>

                <div id="tab-content-register" class="sub-tab-content">
                    <form id="risk-calculator-form">
                        <fieldset class="risk-fieldset">
                            <legend>1. Identifica√ß√£o da √Årvore</legend>
                            <div class="form-grid">
                                <div><label for="risk-data">Data da Coleta:</label><input type="date" id="risk-data" name="risk-data"></div>
                                <div><label for="risk-especie">Esp√©cie (Nome/Tag):</label><input type="text" id="risk-especie" name="risk-especie" required autocomplete="off"></div>
                                <div><label for="risk-local">Local (Endere√ßo/Setor):</label><input type="text" id="risk-local" name="risk-local" autocomplete="street-address"></div>
                                
                                <div>
                                    <label for="risk-altura">Altura Total (m):</label>
                                    <div style="display: flex; gap: 5px;">
                                        <input type="number" id="risk-altura" name="risk-altura" min="0" step="0.1" placeholder="0.0">
                                        <button type="button" id="btn-measure-height-form" style="padding:0 10px; background:var(--color-primary-dark); color:white; border:none; border-radius:4px; cursor:pointer;" title="Abrir Clin√¥metro">üìê</button>
                                    </div>
                                </div>

                                <div><label for="risk-coord-x">Coord. X (UTM ou Lon):</label><input type="text" id="risk-coord-x" name="risk-coord-x" autocomplete="off"></div>
                                <div><label for="risk-coord-y">Coord. Y (UTM ou Lat):</label><input type="text" id="risk-coord-y" name="risk-coord-y" autocomplete="off"></div>
                                <div class="gps-button-container">
                                    <button type="button" id="get-gps-btn">üõ∞Ô∏è Capturar GPS</button>
                                    <span id="gps-status"></span>
                                </div>
                                
                                <div>
                                    <label for="risk-dap">DAP (cm):</label>
                                    <div style="display: flex; gap: 5px;">
                                        <input type="number" id="risk-dap" name="risk-dap" min="0" step="any" placeholder="0.0">
                                        <button type="button" id="btn-measure-dap-form" style="padding:0 10px; background:var(--color-primary-dark); color:white; border:none; border-radius:4px; cursor:pointer;" title="Abrir Medidor DAP">üìè</button>
                                    </div>
                                </div>
                                
                                <div><label for="risk-distancia-obs">Dist. Observador (m):</label><input type="number" id="risk-distancia-obs" name="risk-distancia-obs" min="0" step="0.5" placeholder="Ex: 10"></div>
                                <div><label for="risk-avaliador">Avaliador:</label><input type="text" id="risk-avaliador" name="risk-avaliador" autocomplete="name"></div>
                            </div>
                            <div><label for="risk-obs">Observa√ß√µes (Opcional):</label><textarea id="risk-obs" name="risk-obs" rows="3" placeholder="Ex: Cavidade no tronco..."></textarea></div>
                            <div class="photo-upload-container">
                                <label for="tree-photo-input" class="photo-btn">üì∑ Adicionar Foto</label>
                                <input type="file" id="tree-photo-input" accept="image/*" capture="environment" style="display: none;">
                                <div id="photo-preview-container"><button type="button" id="remove-photo-btn" style="display:none;">&times;</button></div>
                            </div>
                        </fieldset>
                        
                        <fieldset class="risk-fieldset">
                            <legend>2. Lista de Verifica√ß√£o de Risco</legend>
                            <table class="risk-table">
                                <thead><tr><th>N¬∫</th><th>Pergunta</th><th>Peso</th><th>Sim</th></tr></thead>
                                <tbody>
                                    <tr><td>1</td><td>H√° <span class="checklist-term" data-term-key="galhos-mortos">galhos mortos</span> com di√¢metro superior a 5 cm?</td><td>3</td><td><input type="checkbox" class="risk-checkbox" data-weight="3"></td></tr>
                                    <tr><td>2</td><td>Existem <span class="checklist-term" data-term-key="rachaduras">rachaduras ou fendas</span> no tronco ou galhos principais?</td><td>5</td><td><input type="checkbox" class="risk-checkbox" data-weight="5"></td></tr>
                                    <tr><td>3</td><td>H√° <span class="checklist-term" data-term-key="apodrecimento">sinais de apodrecimento</span> (madeira esponjosa, fungos, cavidades)?</td><td>5</td><td><input type="checkbox" class="risk-checkbox" data-weight="5"></td></tr>
                                    <tr><td>4</td><td>A √°rvore possui uni√µes em ‚ÄúV‚Äù com <span class="checklist-term" data-term-key="casca-inclusa">casca inclusa</span>?</td><td>4</td><td><input type="checkbox" class="risk-checkbox" data-weight="4"></td></tr>
                                    <tr><td>5</td><td>H√° <span class="checklist-term" data-term-key="galhos-cruzados">galhos cruzados</span> ou friccionando entre si?</td><td>2</td><td><input type="checkbox" class="risk-checkbox" data-weight="2"></td></tr>
                                    <tr><td>6</td><td>A √°rvore apresenta <span class="checklist-term" data-term-key="copa-assimetrica">copa assim√©trica</span> (>30% de desequil√≠brio)?</td><td>2</td><td><input type="checkbox" class="risk-checkbox" data-weight="2"></td></tr>
                                    <tr><td>7</td><td>H√° sinais de <span class="checklist-term" data-term-key="inclinacao">inclina√ß√£o anormal</span> ou recente?</td><td>5</td><td><input type="checkbox" class="risk-checkbox" data-weight="5"></td></tr>
                                    <tr><td>8</td><td>A √°rvore est√° pr√≥xima a vias p√∫blicas ou √°reas de circula√ß√£o?</td><td>5</td><td><input type="checkbox" class="risk-checkbox" data-weight="5"></td></tr>
                                    <tr><td>9</td><td>H√° risco de queda sobre edifica√ß√µes, ve√≠culos ou pessoas?</td><td>5</td><td><input type="checkbox" class="risk-checkbox" data-weight="5"></td></tr>
                                    <tr><td>10</td><td>A √°rvore interfere em redes el√©tricas ou estruturas urbanas?</td><td>4</td><td><input type="checkbox" class="risk-checkbox" data-weight="4"></td></tr>
                                    <tr><td>11</td><td>A esp√©cie √© conhecida por apresentar alta taxa de falhas?</td><td>3</td><td><input type="checkbox" class="risk-checkbox" data-weight="3"></td></tr>
                                    <tr><td>12</td><td>A √°rvore j√° sofreu podas dr√°sticas ou <span class="checklist-term" data-term-key="brotacao-intensa">brota√ß√£o epic√≥rmica intensa</span>?</td><td>3</td><td><input type="checkbox" class="risk-checkbox" data-weight="3"></td></tr>
                                    <tr><td>13</td><td>H√° cal√ßadas rachadas ou tubula√ß√µes expostas pr√≥ximas √† base?</td><td>3</td><td><input type="checkbox" class="risk-checkbox" data-weight="3"></td></tr>
                                    <tr><td>14</td><td>H√° <span class="checklist-term" data-term-key="perda-raizes">perda vis√≠vel de ra√≠zes</span> de sustenta√ß√£o (>40%)?</td><td>5</td><td><input type="checkbox" class="risk-checkbox" data-weight="5"></td></tr>
                                    <tr><td>15</td><td>H√° sinais de <span class="checklist-term" data-term-key="compactacao">compacta√ß√£o</span> ou asfixia radicular?</td><td>3</td><td><input type="checkbox" class="risk-checkbox" data-weight="3"></td></tr>
                                    <tr><td>16</td><td>H√° <span class="checklist-term" data-term-key="apodrecimento">apodrecimento em ra√≠zes</span> prim√°rias (>3 cm)?</td><td>5</td><td><input type="checkbox" class="risk-checkbox" data-weight="5"></td></tr>
                                </tbody>
                            </table>
                            <div class="mobile-checklist-wrapper">
                                <div class="mobile-checklist-card"></div>
                                <div class="mobile-checklist-nav">
                                    <button type="button" id="checklist-prev">‚ùÆ Anterior</button>
                                    <span class="checklist-counter">1 / 16</span>
                                    <button type="button" id="checklist-next">Pr√≥xima ‚ùØ</button>
                                </div>
                            </div>
                        </fieldset>
                        
                        <div class="risk-buttons-area">
                            <button type="submit" id="add-tree-btn">‚ûï Adicionar √Årvore</button>
                            <button type="button" id="reset-risk-form-btn">Limpar Campos</button>
                        </div>
                    </form>
                </div>
                
                <div id="tab-content-summary" class="sub-tab-content">
                    <fieldset class="risk-fieldset">
                        <legend>3. √Årvores Cadastradas</legend>
                        <div class="table-filter-container"><input type="text" id="table-filter-input" placeholder="üîé Filtrar..." autocomplete="off"></div>
                        <div id="summary-table-container"><p id="summary-placeholder">Nenhuma √°rvore cadastrada ainda.</p></div>
                        <div id="import-export-controls" class="risk-buttons-area">
                            <input type="file" id="zip-importer" style="display: none;"><input type="file" id="csv-importer" style="display: none;">
                            <button type="button" id="import-data-btn" class="export-btn">üì§ Importar Dados</button>
                            <button type="button" id="export-data-btn" class="export-btn">üì• Exportar Dados</button>
                            <button type="button" id="generate-pdf-btn" class="export-btn" style="border-color: #D32F2F; color: #D32F2F; display: inline-flex !important;">üìÑ Gerar Laudo PDF</button>
                            <button type="button" id="send-email-btn" class="export-btn">üìß Enviar por Email</button>
                            <button type="button" id="clear-all-btn" class="export-btn">üóëÔ∏è Limpar Tabela</button>
                        </div>
                        <div id="zip-status" style="display: none;"><span class="spinner"></span><span id="zip-status-text">Processando...</span></div>
                    </fieldset>
                </div>
                
                <div id="tab-content-mapa" class="sub-tab-content mapa-tab">
                    <fieldset class="risk-fieldset">
                        <legend>Mapa de Localiza√ß√£o e Risco</legend>
                        <div id="map-legend-filter">
                            <h4>Legenda / Filtro</h4>
                            <div class="legend-filter-grid">
                                <div class="legend-filter"><input type="radio" id="filter-todos" name="risk-filter" value="Todos" checked><label for="filter-todos">Todos</label></div>
                                <div class="legend-filter"><input type="radio" id="filter-alto" name="risk-filter" value="Alto Risco"><label for="filter-alto"><span class="legend-dot" style="background-color: #C62828;"></span> Alto Risco</label></div>
                                <div class="legend-filter"><input type="radio" id="filter-medio" name="risk-filter" value="M√©dio Risco"><label for="filter-medio"><span class="legend-dot" style="background-color: #E65100;"></span> M√©dio Risco</label></div>
                                <div class="legend-filter"><input type="radio" id="filter-baixo" name="risk-filter" value="Baixo Risco"><label for="filter-baixo"><span class="legend-dot" style="background-color: #2E7D32;"></span> Baixo Risco</label></div>
                            </div>
                        </div>
                        <div id="map-info-box" class="hidden"></div>
                        <div id="map-container" style="height: 60vh; width: 100%; background-color: #f0f0f0;"></div>
                        <div class="form-grid" style="margin-top: 15px; gap: 10px;">
                            <div><label for="default-utm-zone">Zona UTM Padr√£o (Ex: 23K):</label><input type="text" id="default-utm-zone" placeholder="Ex: 23K" style="height: 38px;" autocomplete="off"><small style="color: #555; font-size: 0.8em;">(Necess√°rio para dados antigos ou importados)</small></div>
                            <button type="button" id="zoom-to-extent-btn" class="export-btn">üìç Aproximar dos Pontos</button>
                            <button type="button" id="toggle-map-layer-btn" class="export-btn" style="border-color: #0277BD; color: #0277BD;">üó∫Ô∏è Ruas</button>
                            <button type="button" id="show-my-location-btn" class="export-btn map-geolocation-btn">üõ∞Ô∏è Minha Posi√ß√£o</button>
                        </div>
                    </fieldset>
                </div>
            </section>
        </div>

        <section id="gemini-chat">
            <h2>ü§ñ Assistente Digital</h2>
            <div class="chat-container">
                <div id="chat-response-box"><p class="chat-placeholder">Fa√ßa uma pergunta espec√≠fica sobre o manual...</p></div>
                <div class="chat-input-area"><input type="text" id="chat-input" placeholder="Digite sua pergunta..." autocomplete="off"><button id="chat-send-btn">Enviar</button></div>
            </div>
        </section>

        <section id="fale-conosco">
            <h2>üìß D√∫vidas</h2>
            <div class="contact-form-container">
                <form id="contact-form" class="contact-form">
                    <label for="nome">Seu Nome:</label><input type="text" id="nome" name="Nome" required placeholder="Seu nome" autocomplete="name">
                    <label for="email">Seu Email:</label><input type="email" id="email" name="Email_de_Retorno" required placeholder="email" autocomplete="email">
                    <label for="assunto">Assunto:</label><input type="text" id="assunto" name="Assunto" required placeholder="Assunto" autocomplete="off">
                    <label for="mensagem">Mensagem:</label><textarea id="mensagem" name="Mensagem" rows="5" required placeholder="Escreva aqui..."></textarea>
                    <button type="submit" class="send-btn">Enviar</button>
                </form>
            </div>
        </section>

    </main>

    <a href="#page-top" id="back-to-top-btn" title="Voltar ao Topo">&#9650;</a>
    
    <footer class="footer-manual">
        <p>&copy; 2025 ArborIA. Solu√ß√µes em Tecnologia Florestal.</p>
    </footer>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.9.0/proj4.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    
    <div id="toast-notification"></div>

    <div class="modal-overlay" id="action-modal">
        <div class="modal-dialog">
            <h3 id="modal-title">T√≠tulo</h3><p id="modal-description">Descri√ß√£o.</p>
            <div class="modal-actions"></div>
        </div>
    </div>
    
    <div class="modal-dialog photo-viewer-dialog" id="photo-viewer-dialog" style="display: none; z-index: 1001;">
      <h3 id="photo-viewer-title">Foto da √Årvore</h3>
      <button type="button" class="photo-viewer-close" id="photo-viewer-close" title="Fechar">&times;</button>
      <div class="photo-viewer-content" id="photo-viewer-content"></div>
    </div>
    
    <script type="module" src="js/main.js?v=72.0"></script>

</body>
</html>
